#!/usr/bin/make -f

VERSION=1.84.1

%:
	dh $@

override_dh_auto_clean:
	ischroot || bash fetch.sh upstream $(VERSION) \
		e4f3331794f1a32c56f837030912d80b5a3d9669f4b497c91611d65bd6ada97b \
		5a4549888504a1a2336d6f6210af945a2c772b487555c432fa1fa08ea72e5b6a

override_dh_auto_build:
	just version=$(VERSION)

override_dh_auto_install:
	just version=$(VERSION) rootdir=debian/tmp install
	if test $(DEB_TARGET_GNU_CPU) = "x86_64"; then \
		patchelf --add-needed /usr/lib/rustlib/$(DEB_TARGET_GNU_CPU)-unknown-linux-gnu/lib/libLLVM.so.18.1-rust-$(VERSION)-stable  debian/tmp/usr/bin/cargo-clippy; \
		patchelf --add-needed /usr/lib/rustlib/$(DEB_TARGET_GNU_CPU)-unknown-linux-gnu/lib/libLLVM.so.18.1-rust-$(VERSION)-stable  debian/tmp/usr/bin/clippy-driver; \
		patchelf --add-needed /usr/lib/rustlib/$(DEB_TARGET_GNU_CPU)-unknown-linux-gnu/lib/libLLVM.so.18.1-rust-$(VERSION)-stable  debian/tmp/usr/bin/rustc; \
		patchelf --add-needed /usr/lib/rustlib/$(DEB_TARGET_GNU_CPU)-unknown-linux-gnu/lib/libLLVM.so.18.1-rust-$(VERSION)-stable  debian/tmp/usr/bin/rustfmt; \
	fi

override_dh_strip:

override_dh_shlibdeps:
	# dh_shlibdeps -Xclippy -l/usr/lib/rustlib/$(DEB_TARGET_GNU_CPU)-unknown-linux-gnu/lib/
