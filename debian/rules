#!/usr/bin/make -f

VERSION=1.90.0

%:
	dh $@

override_dh_auto_clean:
	ischroot || bash fetch.sh upstream $(VERSION) \
		bff8974f2d3ee6c0e6ac926b533f65bbdd3697d2c2b925bdae5f45b9eed10a67 \
		59f1883fcdd2d7243d2fd1ed19f22e05219251227abacfa3d656aebfbcc5e838

override_dh_auto_build:
	just version=$(VERSION)

override_dh_auto_install:
	just version=$(VERSION) rootdir=debian/tmp install
	patchelf --add-needed /usr/lib/rustlib/$(DEB_TARGET_GNU_CPU)-unknown-linux-gnu/lib/libLLVM.so.20.1-rust-$(VERSION)-stable  debian/tmp/usr/bin/cargo-clippy; \
	patchelf --add-needed /usr/lib/rustlib/$(DEB_TARGET_GNU_CPU)-unknown-linux-gnu/lib/libLLVM.so.20.1-rust-$(VERSION)-stable  debian/tmp/usr/bin/clippy-driver; \
	patchelf --add-needed /usr/lib/rustlib/$(DEB_TARGET_GNU_CPU)-unknown-linux-gnu/lib/libLLVM.so.20.1-rust-$(VERSION)-stable  debian/tmp/usr/bin/rustc; \
	patchelf --add-needed /usr/lib/rustlib/$(DEB_TARGET_GNU_CPU)-unknown-linux-gnu/lib/libLLVM.so.20.1-rust-$(VERSION)-stable  debian/tmp/usr/bin/rustfmt; \

override_dh_strip:

override_dh_shlibdeps:
	# dh_shlibdeps -Xclippy -l/usr/lib/rustlib/$(DEB_TARGET_GNU_CPU)-unknown-linux-gnu/lib/
